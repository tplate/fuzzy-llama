> locf(c(NA,NA,1,NA,NA,2,3,NA))
[1] NA NA  1  1  1  2  3  3
> locf(c(0,NA,1,NA,NA,2,3,NA))
[1] 0 0 1 1 1 2 3 3
> locf(c(0,NA,1,NA,NA,2,3,4))
[1] 0 0 1 1 1 2 3 4
> locf(c(NA,NA,1,NA,NA,2,3,NA), 0)
[1] 0 0 1 1 1 2 3 3
> locf(c(), 0)
NULL
> locf(numeric(0), 0)
numeric(0)
> storage.mode(locf(single(0), 0))
[1] "double"
> 
> set.seed(1)
> x <- matrix(1:24, ncol=4)
> # x[sample(24, 12)] <- NA in S-PLUS
> x[-c(6,9,10,12,13,14,15,17,18,20,21,23)] <- NA
> x
     [,1] [,2] [,3] [,4]
[1,]   NA   NA   13   NA
[2,]   NA   NA   14   20
[3,]   NA    9   15   21
[4,]   NA   10   NA   NA
[5,]   NA   NA   17   23
[6,]    6   12   18   NA
> locf(x)
     [,1] [,2] [,3] [,4]
[1,]   NA   NA   13   NA
[2,]   NA   NA   14   20
[3,]   NA    9   15   21
[4,]   NA   10   15   21
[5,]   NA   10   17   23
[6,]    6   12   18   23
> locf(x, 0)
     [,1] [,2] [,3] [,4]
[1,]    0    0   13    0
[2,]    0    0   14   20
[3,]    0    9   15   21
[4,]    0   10   15   21
[5,]    0   10   17   23
[6,]    6   12   18   23
> locf(x, 0, 2, NA)
     [,1] [,2] [,3] [,4]
[1,]    0    0   13    0
[2,]    0    0   14   20
[3,]    0    9   15   21
[4,]   NA   10   15   21
[5,]   NA   10   17   23
[6,]    6   12   18   23
> locf(x, 0, 1, NA)
     [,1] [,2] [,3] [,4]
[1,]    0    0   13    0
[2,]    0    0   14   20
[3,]   NA    9   15   21
[4,]   NA   10   15   21
[5,]   NA   10   17   23
[6,]    6   12   18   23
> 
> locf(as.data.frame(x), 0)
  V1 V2 V3 V4
1  0  0 13  0
2  0  0 14 20
3  0  9 15 21
4  0 10 15 21
5  0 10 17 23
6  6 12 18 23
> locf(as.data.frame(x), 0, 2, NA)
  V1 V2 V3 V4
1  0  0 13  0
2  0  0 14 20
3  0  9 15 21
4 NA 10 15 21
5 NA 10 17 23
6  6 12 18 23
> 
> y <- array(1:32, c(4,4,2))
> # y[sample(length(y), length(y)/2)] <- NA # In S-PLUS
> y[-c(1,2,5,6,8,9,10,11,14,15,20,21,22,23,24,32)] <- NA
> y
, , 1

     [,1] [,2] [,3] [,4]
[1,]    1    5    9   NA
[2,]    2    6   10   14
[3,]   NA   NA   11   15
[4,]   NA    8   NA   NA

, , 2

     [,1] [,2] [,3] [,4]
[1,]   NA   21   NA   NA
[2,]   NA   22   NA   NA
[3,]   NA   23   NA   NA
[4,]   20   24   NA   32

> locf(y)
, , 1

     [,1] [,2] [,3] [,4]
[1,]    1    5    9   NA
[2,]    2    6   10   14
[3,]    2    6   11   15
[4,]    2    8   11   15

, , 2

     [,1] [,2] [,3] [,4]
[1,]   NA   21   NA   NA
[2,]   NA   22   NA   NA
[3,]   NA   23   NA   NA
[4,]   20   24   NA   32

> locf(y, dist=1)
, , 1

     [,1] [,2] [,3] [,4]
[1,]    1    5    9   NA
[2,]    2    6   10   14
[3,]    2    6   11   15
[4,]   NA    8   11   15

, , 2

     [,1] [,2] [,3] [,4]
[1,]   NA   21   NA   NA
[2,]   NA   22   NA   NA
[3,]   NA   23   NA   NA
[4,]   20   24   NA   32

> 
> as.vector(locf(matrix(y, ncol=2), dist=3))
 [1]  1  2  2  2  5  6  6  8  9 10 11 11 11 14 15 15 NA NA NA 20 21 22 23 24 24
[26] 24 24 NA NA NA NA 32
> as.vector(locf(y, dist=3, dims=2))
 [1]  1  2  2  2  5  6  6  8  9 10 11 11 11 14 15 15 NA NA NA 20 21 22 23 24 24
[26] 24 24 NA NA NA NA 32
> as.vector(locf(y, dist=3, dims=1))
 [1]  1  2  2  2  5  6  6  8  9 10 11 11 NA 14 15 15 NA NA NA 20 21 22 23 24 NA
[26] NA NA NA NA NA NA 32
> as.vector(locf(y, dist=3))
 [1]  1  2  2  2  5  6  6  8  9 10 11 11 NA 14 15 15 NA NA NA 20 21 22 23 24 NA
[26] NA NA NA NA NA NA 32
> 
> nocb.ref(c(NA,NA,1,NA,NA,2,3,NA))
[1]  1  1  1  2  2  2  3 NA
> nocb.ref(c(0,NA,1,NA,NA,2,3,NA))
[1]  0  1  1  2  2  2  3 NA
> nocb.ref(c(0,NA,1,NA,NA,2,3,4))
[1] 0 1 1 2 2 2 3 4
> nocb.ref(c(NA,NA,1,NA,NA,2,3,NA), 0)
[1] 1 1 1 2 2 2 3 0
> nocb.ref(c(), 0)
NULL
> nocb.ref(numeric(0), 0)
numeric(0)
> storage.mode(nocb.ref(single(0), 0))
[1] "double"
> 
> nocb.ref(x)
     [,1] [,2] [,3] [,4]
[1,]    6    9   13   20
[2,]    6    9   14   20
[3,]    6    9   15   21
[4,]    6   10   17   23
[5,]    6   12   17   23
[6,]    6   12   18   NA
> nocb.ref(x, 0)
     [,1] [,2] [,3] [,4]
[1,]    6    9   13   20
[2,]    6    9   14   20
[3,]    6    9   15   21
[4,]    6   10   17   23
[5,]    6   12   17   23
[6,]    6   12   18    0
> nocb.ref(x, 0, 2, NA)
     [,1] [,2] [,3] [,4]
[1,]   NA    9   13   20
[2,]   NA    9   14   20
[3,]   NA    9   15   21
[4,]    6   10   17   23
[5,]    6   12   17   23
[6,]    6   12   18    0
> nocb.ref(x, 0, 1, NA)
     [,1] [,2] [,3] [,4]
[1,]   NA   NA   13   20
[2,]   NA    9   14   20
[3,]   NA    9   15   21
[4,]   NA   10   17   23
[5,]    6   12   17   23
[6,]    6   12   18    0
> 
> nocb.ref(as.data.frame(x), 0)
  V1 V2 V3 V4
1  6  9 13 20
2  6  9 14 20
3  6  9 15 21
4  6 10 17 23
5  6 12 17 23
6  6 12 18  0
> nocb.ref(as.data.frame(x), 0, 2, NA)
  V1 V2 V3 V4
1 NA  9 13 20
2 NA  9 14 20
3 NA  9 15 21
4  6 10 17 23
5  6 12 17 23
6  6 12 18  0
> 
> nocb.ref(y)
, , 1

     [,1] [,2] [,3] [,4]
[1,]    1    5    9   14
[2,]    2    6   10   14
[3,]   NA    8   11   15
[4,]   NA    8   NA   NA

, , 2

     [,1] [,2] [,3] [,4]
[1,]   20   21   NA   32
[2,]   20   22   NA   32
[3,]   20   23   NA   32
[4,]   20   24   NA   32

> nocb.ref(y, dist=1)
, , 1

     [,1] [,2] [,3] [,4]
[1,]    1    5    9   14
[2,]    2    6   10   14
[3,]   NA    8   11   15
[4,]   NA    8   NA   NA

, , 2

     [,1] [,2] [,3] [,4]
[1,]   NA   21   NA   NA
[2,]   NA   22   NA   NA
[3,]   20   23   NA   32
[4,]   20   24   NA   32

> 
> as.vector(nocb.ref(matrix(y, ncol=2), dist=3))
 [1]  1  2  5  5  5  6  8  8  9 10 11 14 14 14 15 NA 20 20 20 20 21 22 23 24 NA
[26] NA NA NA 32 32 32 32
> as.vector(nocb.ref(y, dist=3, dims=2))
 [1]  1  2  5  5  5  6  8  8  9 10 11 14 14 14 15 NA 20 20 20 20 21 22 23 24 NA
[26] NA NA NA 32 32 32 32
> 
> nocb(c(NA,NA,1,NA,NA,2,3,NA))
[1]  1  1  1  2  2  2  3 NA
> nocb(c(0,NA,1,NA,NA,2,3,NA))
[1]  0  1  1  2  2  2  3 NA
> nocb(c(0,NA,1,NA,NA,2,3,4))
[1] 0 1 1 2 2 2 3 4
> nocb(c(NA,NA,1,NA,NA,2,3,NA), 0)
[1] 1 1 1 2 2 2 3 0
> nocb(c(), 0)
NULL
> nocb(numeric(0), 0)
numeric(0)
> storage.mode(nocb(single(0), 0))
[1] "double"
> 
> nocb(x)
     [,1] [,2] [,3] [,4]
[1,]    6    9   13   20
[2,]    6    9   14   20
[3,]    6    9   15   21
[4,]    6   10   17   23
[5,]    6   12   17   23
[6,]    6   12   18   NA
> nocb(x, 0)
     [,1] [,2] [,3] [,4]
[1,]    6    9   13   20
[2,]    6    9   14   20
[3,]    6    9   15   21
[4,]    6   10   17   23
[5,]    6   12   17   23
[6,]    6   12   18    0
> nocb(x, 0, 2, NA)
     [,1] [,2] [,3] [,4]
[1,]   NA    9   13   20
[2,]   NA    9   14   20
[3,]   NA    9   15   21
[4,]    6   10   17   23
[5,]    6   12   17   23
[6,]    6   12   18    0
> nocb(x, 0, 1, NA)
     [,1] [,2] [,3] [,4]
[1,]   NA   NA   13   20
[2,]   NA    9   14   20
[3,]   NA    9   15   21
[4,]   NA   10   17   23
[5,]    6   12   17   23
[6,]    6   12   18    0
> 
> nocb(as.data.frame(x), 0)
  V1 V2 V3 V4
1  6  9 13 20
2  6  9 14 20
3  6  9 15 21
4  6 10 17 23
5  6 12 17 23
6  6 12 18  0
> nocb(as.data.frame(x), 0, 2, NA)
  V1 V2 V3 V4
1 NA  9 13 20
2 NA  9 14 20
3 NA  9 15 21
4  6 10 17 23
5  6 12 17 23
6  6 12 18  0
> 
> nocb(y)
, , 1

     [,1] [,2] [,3] [,4]
[1,]    1    5    9   14
[2,]    2    6   10   14
[3,]   NA    8   11   15
[4,]   NA    8   NA   NA

, , 2

     [,1] [,2] [,3] [,4]
[1,]   20   21   NA   32
[2,]   20   22   NA   32
[3,]   20   23   NA   32
[4,]   20   24   NA   32

> nocb(y, dist=1)
, , 1

     [,1] [,2] [,3] [,4]
[1,]    1    5    9   14
[2,]    2    6   10   14
[3,]   NA    8   11   15
[4,]   NA    8   NA   NA

, , 2

     [,1] [,2] [,3] [,4]
[1,]   NA   21   NA   NA
[2,]   NA   22   NA   NA
[3,]   20   23   NA   32
[4,]   20   24   NA   32

> 
> as.vector(nocb(matrix(y, ncol=2), dist=3))
 [1]  1  2  5  5  5  6  8  8  9 10 11 14 14 14 15 NA 20 20 20 20 21 22 23 24 NA
[26] NA NA NA 32 32 32 32
> as.vector(nocb(y, dist=3, dims=2))
 [1]  1  2  5  5  5  6  8  8  9 10 11 14 14 14 15 NA 20 20 20 20 21 22 23 24 NA
[26] NA NA NA 32 32 32 32
> 
> x <- data.frame(d=as.Date(dateSeq('2001-01-01',len=5)), f=factor(letters[1:5]), x=1:5)
> x[cbind(2:4,1:3)] <- NA
> x
           d    f  x
1 2001-01-01    a  1
2       <NA>    b  2
3 2001-01-03 <NA>  3
4 2001-01-04    d NA
5 2001-01-05    e  5
> locf(x)
           d f x
1 2001-01-01 a 1
2 2001-01-01 b 2
3 2001-01-03 b 3
4 2001-01-04 d 3
5 2001-01-05 e 5
> sapply(locf(x), class)
        d         f         x 
   "Date"  "factor" "integer" 
> 