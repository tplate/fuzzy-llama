> x <- matrix(1:6,ncol=2,dimnames=list(letters[1:3],letters[1:2]))
> x
  a b
a 1 4
b 2 5
c 3 6
> reshape.records(x)
  row col value
1   a   a     1
2   b   a     2
3   c   a     3
4   a   b     4
5   b   b     5
6   c   b     6
> reshape.records(x[1,,drop=F])
  row col value
1   a   a     1
2   a   b     4
> reshape.records(x[1,1,drop=F])
  row col value
1   a   a     1
> reshape.records(x[numeric(0),1,drop=F])
[1] row   col   value
<0 rows> (or 0-length row.names)
> reshape.records(x[1,numeric(0),drop=F])
[1] row   col   value
<0 rows> (or 0-length row.names)
> reshape.records(x[,numeric(0),drop=F])
[1] row   col   value
<0 rows> (or 0-length row.names)
> reshape.records(x[numeric(0),numeric(0),drop=F])
[1] row   col   value
<0 rows> (or 0-length row.names)
> 
> x1 <- data.frame(x=c("A","A","B","B"), y=c("a","b","a","b"), w=1:4)
> x1
  x y w
1 A a 1
2 A b 2
3 B a 3
4 B b 4
> reshape.matrix(x1)
  a b
A 1 2
B 3 4
> reshape.records(reshape.matrix(x1))
  row col value
1   A   a     1
2   B   a     3
3   A   b     2
4   B   b     4
> reshape.records(reshape.matrix(x1),colnames=c("x","y","w"))
  x y w
1 A a 1
2 B a 3
3 A b 2
4 B b 4
> # Zero extent tests
> x1 <- array(1:8,dim=c(2,2,2),dimnames=list(letters[1:2],LETTERS[1:2],c("z", "w")))
> reshape.records(x1[,0,,drop=F], retain=3, colnames=c("date","qaid"), na.rm=T)
[1] date qaid z    w   
<0 rows> (or 0-length row.names)
> reshape.records(x1[,,0,drop=F], retain=2, colnames=c("date","qaid"), na.rm=T)
[1] date qaid A    B   
<0 rows> (or 0-length row.names)
> reshape.records(x1[,,0,drop=F], retain=3, colnames=c("date","qaid"), na.rm=T)
[1] date qaid
< 0 rows> 
> reshape.records(x1[,0,,drop=F], retain=2, colnames=c("date","qaid"))
[1] date qaid
< 0 rows> 
> reshape.records(x1[,0,,drop=F], retain=3, colnames=c("date","qaid"))
[1] date qaid z    w   
<0 rows> (or 0-length row.names)
> reshape.records(x1[,0,,drop=F])
[1] row   col   idx3  value
<0 rows> (or 0-length row.names)
> reshape.records(x1[,,0,drop=F])
[1] row   col   idx3  value
<0 rows> (or 0-length row.names)
> reshape.records(x1[0,,,drop=F])
[1] row   col   idx3  value
<0 rows> (or 0-length row.names)
> 
> x3 <- array(1:12,dim=c(2,2,3),dimnames=list(letters[1:2],letters[24:25],LETTERS[24:26]))
> reshape.records(x3, retain.dim=3)
  row col X Y  Z
1   a   x 1 5  9
2   b   x 2 6 10
3   a   y 3 7 11
4   b   y 4 8 12
> reshape.records(x3[,0,,drop=F], retain.dim=1)
[1] col  idx3 a    b   
<0 rows> (or 0-length row.names)
> reshape.records(x3[,0,,drop=F], retain.dim=2)
[1] row  idx3
< 0 rows> 
> reshape.records(x3[,0,,drop=F], retain.dim=3)
[1] row col X   Y   Z  
<0 rows> (or 0-length row.names)
> 
> reshape.records(data.frame(X=c(a=1,b=2), Y=3:4), retain.dim=2)
  row X Y
1   a 1 3
2   b 2 4
> class(.Last.value)
[1] "data.frame"
> reshape.records(data.frame(X=c(a=1,b=2), Y=3:4), retain.dim=1)
  col a b 
1   X 1 2
2   Y 3 4
> class(.Last.value)
[1] "data.frame"
> reshape.records(data.frame(X=c(a=1,b=2), Y=3:4))
  row col value
1   a   X     1
2   b   X     2
3   a   Y     3
4   b   Y     4
> class(.Last.value)
[1] "data.frame"
> reshape.records(df2d(X=c(a=1,b=2), Y=3:4), retain.dim=2)
  row X Y 
1   a 1 3
2   b 2 4
> class(.Last.value)
[1] "df2d"
> reshape.records(df2d(X=c(a=1,b=2), Y=3:4), retain.dim=1)
     col a b 
[1,]   X 1 2
[2,]   Y 3 4
> class(.Last.value)
[1] "df2d"
> reshape.records(df2d(X=c(a=1,b=2), Y=3:4))
     row col value 
[1,]   a   X     1
[2,]   b   X     2
[3,]   a   Y     3
[4,]   b   Y     4
> class(.Last.value)
[1] "df2d"
> 
> reshape.records(with(list(x=named.obj(dateSeq("2001-01-01",len=5,by="bizdays@NYSEC"),1:5)), cbind(q1=x, q2=x+1)))
          row col value 
 1 2001-01-02  q1     1
 2 2001-01-03  q1     2
 3 2001-01-04  q1     3
 4 2001-01-05  q1     4
 5 2001-01-08  q1     5
 6 2001-01-02  q2     2
 7 2001-01-03  q2     3
 8 2001-01-04  q2     4
 9 2001-01-05  q2     5
10 2001-01-08  q2     6
> reshape.records(with(list(x=named.obj(dateSeq("2001-01-01",len=5,by="bizdays@NYSEC"),1:5)), cbind(q1=x, q2=x+1)), df2d=T)
             row col value 
 [1,] 2001-01-02  q1     1
 [2,] 2001-01-03  q1     2
 [3,] 2001-01-04  q1     3
 [4,] 2001-01-05  q1     4
 [5,] 2001-01-08  q1     5
 [6,] 2001-01-02  q2     2
 [7,] 2001-01-03  q2     3
 [8,] 2001-01-04  q2     4
 [9,] 2001-01-05  q2     5
[10,] 2001-01-08  q2     6
> length(.Last.value)
[1] 3
> 
> (x <- with(list(x=rbind("2001-01-01"=c(q1=1, q2=2), "2001-01-02"=3:4)), abind(f1=x, f2=x+4, along=3)))
, , f1

           q1 q2
2001-01-01  1  2
2001-01-02  3  4

, , f2

           q1 q2
2001-01-01  5  6
2001-01-02  7  8

> 
> reshape.records(x, row.label="date", col.label="qaid", retain=3)
        date qaid f1 f2
1 2001-01-01   q1  1  5
2 2001-01-02   q1  3  7
3 2001-01-01   q2  2  6
4 2001-01-02   q2  4  8
> reshape.records(aperm(x, c(1,2,3)), row.label="date", col.label="qaid", retain=3)
        date qaid f1 f2
1 2001-01-01   q1  1  5
2 2001-01-02   q1  3  7
3 2001-01-01   q2  2  6
4 2001-01-02   q2  4  8
> 
> # Permutations get sort of messed up labels because of the permutations and the retain
> reshape.records(aperm(x, c(1,3,2)), row.label="date", col.label="qaid", retain=2)
        date idx3 f1 f2
1 2001-01-01   q1  1  5
2 2001-01-02   q1  3  7
3 2001-01-01   q2  2  6
4 2001-01-02   q2  4  8
> reshape.records(aperm(x, c(2,1,3)), row.label="qaid", col.label="date", retain=3)
  qaid       date f1 f2
1   q1 2001-01-01  1  5
2   q2 2001-01-01  2  6
3   q1 2001-01-02  3  7
4   q2 2001-01-02  4  8
> reshape.records(aperm(x, c(2,3,1)), row.label="qaid", col.label="date", retain=2)
  qaid       idx3 f1 f2
1   q1 2001-01-01  1  5
2   q2 2001-01-01  2  6
3   q1 2001-01-02  3  7
4   q2 2001-01-02  4  8
> reshape.records(aperm(x, c(3,2,1)), row.label="qaid", col.label="date", retain=1)
  date       idx3 f1 f2
1   q1 2001-01-01  1  5
2   q2 2001-01-01  2  6
3   q1 2001-01-02  3  7
4   q2 2001-01-02  4  8
> reshape.records(aperm(x, c(3,1,2)), row.label="date", col.label="qaid", retain=1)
        qaid idx3 f1 f2
1 2001-01-01   q1  1  5
2 2001-01-02   q1  3  7
3 2001-01-01   q2  2  6
4 2001-01-02   q2  4  8
> 
> # Label more easily using 'colnames'
> reshape.records(aperm(x, c(1,2,3)), colnames=c("date", "qaid", "field")[c(1,2,3)][-3], retain=3)
        date qaid f1 f2
1 2001-01-01   q1  1  5
2 2001-01-02   q1  3  7
3 2001-01-01   q2  2  6
4 2001-01-02   q2  4  8
> reshape.records(aperm(x, c(1,3,2)), colnames=c("date", "qaid", "field")[c(1,3,2)][-2], retain=2)
        date qaid f1 f2
1 2001-01-01   q1  1  5
2 2001-01-02   q1  3  7
3 2001-01-01   q2  2  6
4 2001-01-02   q2  4  8
> reshape.records(aperm(x, c(2,1,3)), colnames=c("date", "qaid", "field")[c(2,1,3)][-3], retain=3)
  qaid       date f1 f2
1   q1 2001-01-01  1  5
2   q2 2001-01-01  2  6
3   q1 2001-01-02  3  7
4   q2 2001-01-02  4  8
> reshape.records(aperm(x, c(2,3,1)), colnames=c("date", "qaid", "field")[c(2,3,1)][-2], retain=2)
  qaid       date f1 f2
1   q1 2001-01-01  1  5
2   q2 2001-01-01  2  6
3   q1 2001-01-02  3  7
4   q2 2001-01-02  4  8
> reshape.records(aperm(x, c(3,2,1)), colnames=c("date", "qaid", "field")[c(3,2,1)][-1], retain=1)
  qaid       date f1 f2
1   q1 2001-01-01  1  5
2   q2 2001-01-01  2  6
3   q1 2001-01-02  3  7
4   q2 2001-01-02  4  8
> reshape.records(aperm(x, c(3,1,2)), colnames=c("date", "qaid", "field")[c(3,1,2)][-1], retain=1)
        date qaid f1 f2
1 2001-01-01   q1  1  5
2 2001-01-02   q1  3  7
3 2001-01-01   q2  2  6
4 2001-01-02   q2  4  8
> 
> 
> x <- data.frame(x=factor(c(1,1,2,4),levels=1:4),y=c("a","b","a","c"),w=(1:4)/2,z=1:4)
> reshape.records(reshape.array(x, 1, 2), na.rm=T, retain.dim=3, factors=F)
  row col   w z
1   1   a 0.5 1
2   2   a 1.5 3
4   1   b 1.0 2
9   4   c 2.0 4
> reshape.records(reshape.array(x, 1, 2), na.rm=T, retain.dim=3, factors=T)
  row col   w z
1   1   a 0.5 1
2   2   a 1.5 3
4   1   b 1.0 2
9   4   c 2.0 4
>
